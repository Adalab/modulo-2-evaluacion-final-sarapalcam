"use strict";const input=document.querySelector(".js-input"),searchBtn=document.querySelector(".js-search-btn"),resetBtn=document.querySelector(".js-reset-btn"),favList=document.querySelector(".js-favorites-list"),resetFavoritesBtn=document.querySelector(".js-reset-favorites-btn"),resultList=document.querySelector(".js-result-list");let favorites=[];function renderFavoriteHighliht(e){let t=[];for(const r of e)t.push(r.id);console.log(t);for(const r of favorites){const i=t.find(e=>e===r);console.log(i);for(const t of e)i===t.id&&t.classList.add("favorite")}}function renderResults(e){resultList.innerHTML="";for(const t of e){const e=document.createElement("li");e.id=""+t.mal_id,e.classList.add("js-li-results"),e.classList.add("anime__resultlist--el");const r=document.createElement("img"),i=document.createElement("p");null===t.image_url||void 0===t.image_url?r.src="https://via.placeholder.com/225x317/ffffff/666666/?text=TV":r.src=t.image_url,r.style="height: 317px; width: 225px; background-size: cover",r.alt="Imagen de portada de "+t.title,r.title="Imagen de portada de "+t.title;const s=document.createTextNode(""+t.title);i.appendChild(s),e.appendChild(r),e.appendChild(i),resultList.appendChild(e),e.addEventListener("click",handleClickResultList)}renderFavoriteHighliht(document.querySelectorAll(".js-li-results"))}function getInputValue(){return input.value}function fetchResults(){const e=getInputValue();fetch("https://api.jikan.moe/v3/search/anime?q="+e).then(e=>e.json()).then(e=>{renderResults(e.results)})}function showResults(){resultList.classList.remove("hidden")}function showFavorites(){favList.classList.remove("hidden")}function highlightFavorite(e){e.currentTarget.classList.toggle("favorite")}function removeFavorites(e){for(const t of e)t.addEventListener("click",handleClickRemove)}function renderFavorite(e){showFavorites(),favList.innerHTML+=`<li class="anime__favlist--el" id="${e.currentTarget.id}"><div class="anime__favlist--container">${e.currentTarget.innerHTML}</div> <i class="far fa-times-circle remove_favorite anime__favlist--remove"></i></li>`;removeFavorites(document.querySelectorAll(".remove_favorite"))}function addFavorite(e){const t=e.currentTarget.id;if(void 0===favorites.find(e=>e===t))favorites.push(e.currentTarget.id),renderFavorite(e);else{const e=favorites.findIndex(e=>e===t);favorites.splice(e,1),favList.childNodes[e].outerHTML=""}}function removeFavoriteFromArray(e){const t=favorites.findIndex(t=>t===e.currentTarget.parentNode.id),r=favorites.splice(t,1),i=resultList.childNodes;for(const e of i)e.id===r[0]&&e.classList.remove("favorite")}function removeFavoriteRender(e){e.currentTarget.parentNode.outerHTML=""}function renderFavs(){showFavorites(),favorites=JSON.parse(localStorage.getItem("favorites")),favList.innerHTML=localStorage.getItem("favorites_html");removeFavorites(document.querySelectorAll(".remove_favorite"))}function handleClickRemove(e){removeFavoriteFromArray(e),removeFavoriteRender(e),localStorage.setItem("favorites",JSON.stringify(favorites)),localStorage.setItem("favorites_html",favList.innerHTML)}function handleClickSearch(e){e.preventDefault(),fetchResults(),showResults()}function handleClickResultList(e){highlightFavorite(e),addFavorite(e),localStorage.setItem("favorites",JSON.stringify(favorites)),localStorage.setItem("favorites_html",favList.innerHTML)}function handleResetBtn(e){e.preventDefault(),input.value="",resultList.innerHTML=""}function handleResetFavoritesBtn(e){e.preventDefault(),favList.innerHTML="",favorites=[];const t=resultList.childNodes;for(const e of t)e.classList.contains("favorite")&&e.classList.remove("favorite");localStorage.clear("favorites")}null!==localStorage.getItem("favorites_html")&&renderFavs(),searchBtn.addEventListener("click",handleClickSearch),resetBtn.addEventListener("click",handleResetBtn),resetFavoritesBtn.addEventListener("click",handleResetFavoritesBtn);