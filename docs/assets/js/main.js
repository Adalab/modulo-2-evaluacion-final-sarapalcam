"use strict";const input=document.querySelector(".js-input"),searchBtn=document.querySelector(".js-search-btn"),resetBtn=document.querySelector(".js-reset-btn"),favList=document.querySelector(".js-favorites-list"),resetFavoritesBtn=document.querySelector(".js-reset-favorites-btn"),resultList=document.querySelector(".js-result-list"),headerMenu=document.querySelector(".js-header-menu"),favoritesSection=document.querySelector(".js-favorites-section"),resultsArrow=document.querySelector(".js-results-arrow");let favorites=[],results=[];function getInputValue(){return input.value}function renderResults(e){resultList.innerHTML="";for(const t of e){const e=document.createElement("li");e.id=""+t.mal_id,e.classList.add("js-li-results"),e.classList.add("anime__results--list--el");const s=document.createElement("img");null===t.image_url||void 0===t.image_url?s.src="https://via.placeholder.com/225x317/ffffff/666666/?text=TV":s.src=t.image_url,s.style="height: 317px; width: 225px; background-size: cover",s.alt="Imagen de portada de "+t.title,s.title="Imagen de portada de "+t.title;const r=document.createElement("p"),i=document.createTextNode(""+t.title),o=document.createElement("img");o.src="./assets/images/favorite.png",o.alt="Corazón de favorito",o.title="Corazón de favorito",o.classList.add("anime__results--list--heart"),o.classList.add("hidden"),r.appendChild(i),e.appendChild(s),e.appendChild(r),e.appendChild(o),resultList.appendChild(e),e.addEventListener("click",handleClickListElement)}showHighlitedResults()}function fetchData(){const e=getInputValue();fetch("https://api.jikan.moe/v3/search/anime?q="+e).then(e=>e.json()).then(e=>{results=[];for(const t of e.results)results.push(t);renderResults(results)})}function toggleFavoriteClass(e){e.currentTarget.classList.toggle("favorite"),e.currentTarget.childNodes[2].classList.toggle("hidden")}function createNewFavorite(e){return{id:e.currentTarget.id,image_url:e.currentTarget.childNodes[0].currentSrc,title:e.currentTarget.childNodes[1].innerText}}function saveFavoritesArray(){localStorage.setItem("favorites",JSON.stringify(favorites))}function renderFavorites(){favList.classList.remove("hidden"),favList.innerHTML="";for(const e of favorites){const t=document.createElement("li");t.id=""+e.id,t.classList.add("anime__favorites--list--el");const s=document.createElement("div");s.classList.add("anime__favorites--list--container");const r=document.createElement("img");r.src=e.image_url,r.style="height: 170px; width: 121px; background-size: cover",r.alt="Imagen de portada de "+e.title,r.title="Imagen de portada de "+e.title;const i=document.createElement("p"),o=document.createTextNode(""+e.title),n=document.createElement("i");n.classList.add("fas"),n.classList.add("fa-times-circle"),n.classList.add("js-remove_favorite"),n.classList.add("anime__favorites--list--remove"),i.appendChild(o),s.appendChild(r),s.appendChild(i),t.appendChild(s),t.appendChild(n),favList.appendChild(t);const a=document.querySelectorAll(".js-remove_favorite");for(const e of a)e.addEventListener("click",handleClickRemoveIcon)}saveFavoritesArray()}function addToFavorites(e){const t=createNewFavorite(e),s=e.currentTarget.id;if(void 0===favorites.find(e=>e.id===s))favorites.push(t);else{const e=favorites.findIndex(e=>e.id===s);favorites.splice(e,1)}renderFavorites(t)}function deleteHighlitedResults(e){const t=e.currentTarget.parentNode.id,s=document.querySelectorAll(".js-li-results");for(const e of s)t===e.id&&(e.classList.remove("favorite"),e.childNodes[2].classList.add("hidden"))}function removeFromFavorites(e){const t=e.currentTarget.parentNode.id,s=favorites.findIndex(e=>e.id===t);favorites.splice(s,1),deleteHighlitedResults(e),renderFavorites()}function resetResults(){input.value="",resultList.innerHTML=""}function deleteAllHighlitedResults(){const e=document.querySelectorAll(".js-li-results");for(const t of e)t.classList.remove("favorite"),t.childNodes[2].classList.add("hidden")}function removeAllFavorites(){favorites=[],localStorage.clear("favorites"),deleteAllHighlitedResults(),renderFavorites()}function showHighlitedResults(){const e=document.querySelectorAll(".js-li-results");for(const t of e)for(const e of favorites)e.id===t.id&&(t.classList.add("favorite"),t.childNodes[2].classList.remove("hidden"))}function restoreSavedFavorites(){null!==localStorage.getItem("favorites")&&(favorites=JSON.parse(localStorage.getItem("favorites")),renderFavorites())}function toggleShowFavorites(){favoritesSection.classList.toggle("hidden")}function toggleMenuRotation(){headerMenu.classList.toggle("rotate")}function scrollToTop(){window.scrollTo(0,0)}function handleClickSearch(e){e.preventDefault(),fetchData(),resultsArrow.classList.remove("hidden")}function handleClickListElement(e){toggleFavoriteClass(e),addToFavorites(e)}function handleClickRemoveIcon(e){removeFromFavorites(e)}function handleClickReset(e){e.preventDefault(),resetResults(),resultsArrow.classList.add("hidden")}function handleClickResetFavs(e){e.preventDefault(),removeAllFavorites(),toggleMenuRotation(),favoritesSection.classList.add("hidden")}function handleClickHeader(){toggleShowFavorites(),toggleMenuRotation(),scrollToTop()}function handleClickArrow(){scrollToTop()}restoreSavedFavorites(),searchBtn.addEventListener("click",handleClickSearch),resetBtn.addEventListener("click",handleClickReset),resetFavoritesBtn.addEventListener("click",handleClickResetFavs),headerMenu.addEventListener("click",handleClickHeader),resultsArrow.addEventListener("click",handleClickArrow);